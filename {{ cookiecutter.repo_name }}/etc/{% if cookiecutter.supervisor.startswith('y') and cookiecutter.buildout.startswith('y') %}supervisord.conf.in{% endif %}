[inet_http_server]
port = 0.0.0.0:${ports:supervisor}

[supervisord]
logfile = ${buildout:directory}/var/log/supervisord.log
logfile_maxbytes = 50MB
logfile_backups = 1
loglevel = info
pidfile = ${buildout:directory}/var/run/supervisord.pid
nodaemon = false
minfds = 800
childlogdir = ${buildout:directory}/var/log/supervisor

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisorctl]
serverurl = http://localhost:${ports:supervisor}
{% if cookiecutter.crate.startswith('y') %}
[program:crate]
command = ${crate:location}/bin/crate -f -Des.config=${buildout:directory}/etc/crate.yml -Des.http.port=${ports:crate} -Des.discovery.zen.ping.unicast.hosts=localhost:${ports:crate_t2} -Des.transport.tcp.port=${ports:crate_t}
priority = 11
redirect_stderr=true

[program:crate2]
command = ${crate:location}/bin/crate -f -Des.config=${buildout:directory}/etc/crate.yml -Des.http.port=${ports:crate2} -Des.discovery.zen.ping.unicast.hosts=localhost:${ports:crate_t} -Des.transport.tcp.port=${ports:crate_t2}
priority = 11
redirect_stderr=true
{%- endif %}
{% if cookiecutter.pyrest.startswith('y') %}
[program:app]
command = ${buildout:bin-directory}/app http_port=${ports:app}
redirect_stderr=true
priority = 1
stopasgroup = true

    {%- if cookiecutter.haproxy.startswith('y') %}
[program:app2]
command = ${buildout:bin-directory}/app http_port=${ports:app2}
redirect_stderr=true
priority = 2
stopasgroup = true

[program:haproxy]
command = ${buildout:parts-directory}/haproxy/sbin/haproxy -f ${buildout:directory}/etc/haproxy.conf
redirect_stderr=true
priority = 10
    {% endif %}
{% endif %}
