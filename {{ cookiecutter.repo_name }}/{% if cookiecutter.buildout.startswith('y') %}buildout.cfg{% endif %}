[buildout]
{%- if cookiecutter.py_package.startswith('y') %}
develop = .
{%- endif %}
extends = versions.cfg
{%- if cookiecutter.crate.startswith('y') %}
          crate.cfg
{%- endif %}
parts = conf
{%- if cookiecutter.supervisor.startswith('y') %}
        supervisor
{%- endif %}
{%- if cookiecutter.py_package.startswith('y') %}
   {%- if cookiecutter.pyrest.startswith('y') %}
        app-scripts
   {%- endif %}
{%- endif %}
{%- if cookiecutter.crate.startswith('y') %}
        crate crate-scripts crate-setup crate-cleanup
{%- endif %}
{%- if cookiecutter.sphinx.startswith('y') %}
        sphinx-html
{%- endif %}

versions = versions
extensions = lovely.buildouthttp
show-picked-versions = true

[ports]
app = 9210
{%- if cookiecutter.supervisor.startswith('y') %}
supervisor = 8300
{%- endif %}
{%-if cookiecutter.crate.startswith('y') %}
crate = 4200
crate_t = 4300
crate2 = 4201
crate_t2 = 4301
{%- endif %}

[settings]
environment = development

[conf]
recipe = z3c.recipe.filetemplate
files = {%- if cookiecutter.supervisor.startswith('y') %} etc/supervisord.conf{%- endif %}
        {% if cookiecutter.pyrest.startswith('y') %}etc/development.ini{%- endif %}
        {% if cookiecutter.crate.startswith('y') %}etc/crate.yml{%- endif %}
extends = ports
{% if cookiecutter.supervisor.startswith('y') %}
[supervisor]
recipe = zc.recipe.egg:script
relative-paths=true
scripts=supervisord
        supervisorctl
eggs = supervisor
initialization = import sys
                 sys.argv[1:1] = ['-c', '${buildout:directory}/etc/supervisord.conf']
{%- endif %}
{% if cookiecutter.sphinx.startswith('y') %}
[sphinx-html]
recipe = zc.recipe.egg:script
eggs = sphinx
    {%- if cookiecutter.py_package.startswith('y') %}
       {{cookiecutter.repo_name}}
    {%- endif %}
dependent-scripts = true
scripts = sphinx-build=sphinx-html
initialization =
  sys.argv.extend(['-E',
                   '${buildout:directory}/docs',
                   '${buildout:directory}/docs/out'])
{%- endif %}
{%- if cookiecutter.py_package.startswith('y') %}
   {% if cookiecutter.pyrest.startswith('y') %}
[app-scripts]
recipe = zc.recipe.egg:scripts
scripts = app proutes pviews pshell ptweens prequest
relative-paths=true
eggs = {{cookiecutter.repo_name}}
       pyramid
interpreter = py
initialization =
    from gevent import monkey
    monkey.patch_all()
    sys.argv.insert(1, '${buildout:directory}/etc/${settings:environment}.ini')
    port = [a for a in sys.argv if 'http_port' in a]
    if not port:
        sys.argv.append('http_port=${ports:app}')
   {%- endif %}
{%- endif %}
